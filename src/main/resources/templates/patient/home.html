<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Patient Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h1 class="mb-4">Patient Dashboard</h1>
        <p>Welcome, <span th:text="${username}">Patient</span>!</p>

        <!-- Scheduled Appointments -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Upcoming Appointments</h5>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Doctor</th>
                            <th>Specialty</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="app : ${appointmentsGrouped['PROGRAMADA']}">
                            <td th:text="${#temporals.format(app.scheduledAt, 'dd-MM-yyyy HH:mm')}">Date</td>
                            <td th:text="${'Dr. ' + app.doctorName + ' ' + app.doctorLastName}">Doctor</td>
                            <td th:text="${app.doctorSpecialty}">Specialty</td>
                            <td><span class="badge bg-primary" th:text="${app.status}">PROGRAMADA</span></td>
                            <td>
                                <form th:action="@{/appointments/{id}/cancel(id=${app.id})}" method="post">
                                    <button type="submit" class="btn btn-danger btn-sm"
                                        onclick="return confirm('Are you sure?');">Cancel</button>
                                </form>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(appointmentsGrouped['PROGRAMADA'])}">
                            <td colspan="5" class="text-center">No upcoming appointments.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Appointment History -->
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">History</h5>
            </div>
            <div class="card-body">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Doctor</th>
                            <th>Specialty</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="app : ${appointmentsGrouped['HISTORIAL']}">
                            <td th:text="${#temporals.format(app.scheduledAt, 'dd-MM-yyyy HH:mm')}">Date</td>
                            <td th:text="${'Dr. ' + app.doctorName + ' ' + app.doctorLastName}">Doctor</td>
                            <td th:text="${app.doctorSpecialty}">Specialty</td>
                            <td>
                                <span class="badge bg-success" th:if="${app.status.name() == 'FINALIZADA'}"
                                    th:text="${app.status}">FINALIZADA</span>
                                <span class="badge bg-danger" th:if="${app.status.name() == 'CANCELADA'}"
                                    th:text="${app.status}">CANCELADA</span>
                            </td>
                            <td>
                                <a th:if="${app.status.name() == 'FINALIZADA'}"
                                    th:href="@{/appointments/{id}/report(id=${app.id})}"
                                    class="btn btn-info btn-sm">View Report</a>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(appointmentsGrouped['HISTORIAL'])}">
                            <td colspan="5" class="text-center">No medical history found.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <form th:action="@{/logout}" method="post" class="mt-4">
            <button type="submit" class="btn btn-danger">Logout</button>
        </form>
    </div>
</body>

</html>